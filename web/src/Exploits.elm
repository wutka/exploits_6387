module Exploits exposing (main)

import Browser
import Html exposing (..)
import Html.Attributes exposing (..)

type alias Instruction =
  {
    address : Int
  , instruction : String
  }

type alias Register =
  {
    name : String
  , value : Int
  }

type alias MemoryRange =
  {
    start : Int
  , end : Int
  }

type alias MemoryMap =
  {
    execStart : Int
  , execEnd : Int
  , dataStart : Int
  , dataEnd : Int
  , stackStart : Int
  , stackEnd : Int
  , ranges : List MemoryRange
  }

type alias MachineState =
  {
    instructions : List Instruction
  , registers : List Register
  , memoryMap : MemoryMap
  }

type alias Model =
  {
    instructions : List Instruction
  , registers : List Register
  , memoryMap : MemoryMap
  }

type IncomingMsg = InitialMachineState MachineState

type alias MessageWrapper =
  {
    messageType : String
  , messageBody : String
  }


initialModel =
  {
    instructions = []
  , registers = []
  , memoryMap =
    {
      execStart = 0
    , execEnd = 0
    , dataStart = 0
    , dataEnd = 0
    , stackStart = 0
    , stackEnd = 0
    , ranges = []
    }
  }

port websocketIn : (String -> msg) -> Sub msg
port websocketOut : String -> Cmd msg

viewDisassembled inst =
    pre [class "code"] [text inst]
    
view model =
    div [] [ div [] [
                      div [id "disasm", class "disasmgrid"] 
                        (List.map viewDisassembled model.instructions)
                    , div [id "registers", class "reggrid"] []
                    ]
           , div [] [
                      div [id "memory", class "memgrid"] []
                    , div [id "command", class "cmdgrid"] []
                    ]
           ]

update msg model = model

readWebsocketMessage : String -> Sub IncomingMsg
readWebsocketMessage str =

subscriptions : Model -> Sub IncomingMsg
subscriptions model =
    websocketIn readWebsocketMessage

main = Browser.element
    { init = initialModel
    , view = view
    , update = update
    , subscriptions = subscriptions
    }
