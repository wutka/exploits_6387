#include "target_lib.h"

int check_password();
int check_password_impl();
void open_lock();

char *gets(char *);
int strcmp(char *c1, char *c2);

char prompt1[] = "Please enter lock password:";
char prompt2[] = "Invalid password, _ tries left:";

char open_char = 'x';

int main()
{
    init_term();

    if (check_password()) {
        open_lock();
    } else {
        write(1, "x", 1);
    }

    finish_term();
}

int check_password()
{
    return check_password_impl();
}

int check_password_impl()
{
    char password[16];

    for (int i=0; i < 3; i++) {
        if (i == 0) {
            prompt(prompt1, sizeof(prompt1), password);
        } else {
            prompt2[18] = '0' + (3-i);
            prompt(prompt2, sizeof(prompt2), password);
        }
        open_char = '!';
        if (validate_password(password)) {
            return 1;
        }
    }
    open_char = 'x';
    return 0;
}

void open_lock() {
    write(1, &open_char, 1);
}

