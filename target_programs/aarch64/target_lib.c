#include <asm-generic/termbits.h>
#include <asm-generic/ioctls.h>

#define __SYS_read 0
#define __SYS_write 1
#define __SYS_ioctl 16
#define __SYS_exit 60

void _start()
{
    struct termios t;
    int err = ioctl(0, TCGETS, &t);
    t.c_lflag &= ~(ICANON | ECHO);
    err = ioctl(0, TCSETS, &t);

    int x = main();

    err = ioctl(0, TCGETS, &t);
    t.c_lflag |= (ICANON | ECHO);
    err = ioctl(0, TCSETS, &t);
    exit(x);
}

int write(int fd, void *data, int len) {
    asm volatile(
	"mov x8, #0x40\n\t"
	"svc #0\n\t"
	:
	:
	: "x0", "x1", "x2", "x8"
	);
}

int ioctl(int fd, int arg, void *data) {
    asm volatile(
	"mov x8, #0x1d; svc #0"
	:
	:
	: "x0", "x1", "x2", "x8");
}

int read(int fd, void *data, int len) {
    asm volatile(
	"mov x8,#0x3f; svc #0"
	:
	:
	: "x0", "x1", "x2", "x8");
}

void exit(int code) {
    asm volatile (
	"mov x8, #0x5d; svc #0"
	:
	:
	: "x0", "x8");
}
